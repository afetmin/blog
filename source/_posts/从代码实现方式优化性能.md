---
title: 从代码实现方式优化性能
date: 2025-03-09 07:58:05
categories: js
tags: ['性能优化']
---

1. 使用多态代替条件判断

2. 参数传入使用平铺参数代替对象参数
没有必要包裹一层对象，增加创建和 GC 开销 [benchmark](https://perf.link/#eyJpZCI6Im5scHNodGtjZHppIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6ImZ1bmN0aW9uIGZvbyhvKSB7XG4gIG8uYSArIG8uYlxufVxuZnVuY3Rpb24gYmFyKGEsIGIpIHtcbiAgYSArIGJcbn0iLCJ0ZXN0cyI6W3sibmFtZSI6IkZpbmQgaXRlbSAxMDAiLCJjb2RlIjoiZm9vKHthOjEsYjoyfSkiLCJydW5zIjpbMjkwMDAwLDM2NzkwMDAsMjI5MzAwMCwzMzkwMDAwLDEwMzA0MDAwLDQwMjYwMDAsODc5MDAwLDk3NzIwMDAsNDA5NjAwMCw0NTk2MDAwLDE2NjI4MDAwLDcwNDcwMDAsMTE2MTUwMDAsNzU1MDAwMCwzMjM4MDAwLDE5MjkxMDAwLDE5NjM1MDAwLDM5MzAwMCwxNjMzNjAwMCw4NTAwMCw1MTgwMDAwLDczMTAwMCw0NDM1MDAwLDgxMjAwMCwxNzczMDAwLDUxMTAwMCwyMDA3MDAwLDEwODcwMDAsMzA1NTAwMCwxNTE5ODAwMCwxNzkwMDAsMTgzOTAwMCwxODQxMDAwLDg2NzAwMCw1MTEwMDAsMTQyMjUwMDAsNjEwMDAwLDE1NzMwMDAsMTM1NzAwMCwyNzc2MDAwLDE0ODAwMDAsMTc5NDIwMDAsOTE1MDAwLDQyMjMwMDAsMTM3MzAwMCwxNTk5MDAwLDIwNTIwMDAsMTUxNTAwMDAsMTI4MzAwMCwxNzMwMDAwLDIyMDcwMDAsMjAzNDAwMCwxMjI1ODAwMCw1MTEwMDAsMzg2NDAwMCw1MTEwMDAsNTExMDAwLDI4MDYwMDAsOTAwOTAwMCw2MjkwMDAsNjkzMjAwMCw5MTMwMDAsNTExMDAwLDIwMTg5MDAwLDUxMTAwMCwxMDE1MDAwLDg1MzAwMCwxNDc5MDAwLDE2OTQwMDAsMTM0MTIwMDAsMTgwNTQwMDAsNzMxMDAwLDIwNTIwMDAsMTM0NDAwMCwxNzc4OTAwMCwzNDAwMDAsMzA1NzAwMCwxNzA4MDAwLDE2NDUwMDAsMTA2NTAwMCwxMjYwNjAwMCwxOTYxOTAwMCw4MjMwMDAsMTM3NzAwMCwzMjM1MDAwLDEyOTA5MDAwLDExMDAwLDQ3NTIwMDAsMjA3MDIwMDAsMjY0NTAwMCw5OTYwMDAsMTIzODUwMDAsMTM3MzAwMCwxNTg1MDAwLDIwNTIwMDAsMjAyMzAwMCwyMzc5MDAwLDE2NTk1MDAwLDUxMTAwMCw0NTUzMDAwXSwib3BzIjo1MDYyMjIwfSx7Im5hbWUiOiJGaW5kIGl0ZW0gMjAwIiwiY29kZSI6ImJhcigxLDIpIiwicnVucyI6WzExMjAwMCw0MDUwMDAwLDI2MDIwMDAsMzA3MjAwMCwxMDcwMzAwMCw0OTY3MDAwLDEyODI3MDAwLDgwMDcwMDAsMTcyODAwMCwxOTk5MDAwLDEyNzM2MDAwLDc2NDUwMDAsNjc3NjAwMCw4MDc0MDAwLDM4ODkwMDAsMTc2NjMwMDAsMTgyNTIwMDAsMTkwNDIwMDAsMTcwNzMwMDAsMjAwNzEwMDAsMjQ5MzAwMCwyMTAxODAwMCwzNTE2MDAwLDEyMzg3MDAwLDQ1MTAwMCw0MTEwMDAsODg2MDAwLDIwMzEzMDAwLDE5NzQwMDAsMTMwNjMwMDAsMTg4OTQwMDAsNDExMDAwLDYyMzAwMCwyMzkwMDAsMTkwMDAsMTM3ODUwMDAsNDExMDAwLDQxMTAwMCw0MTEwMDAsMTMzODAwMCw3NzMwMDAsMTcwNTUwMDAsMjAzMzUwMDAsMTc2MTAwMCw0MTEwMDAsNTUwMDAwLDQxMTAwMCwxMTUzOTAwMCwzMDkwMDAsNDYyMDAwLDY3MjAwMCw0NzEwMDAsMTM5NjMwMDAsMTk3NzUwMDAsMzQ1MzAwMCwyNDEwMDAsMjE2NTYwMDAsMjUzMDAwMCw2MTQ3MDAwLDIwMzYwMDAwLDMyOTAwMDAsNDExMDAwLDIxNDk2MDAwLDE5OTQ3MDAwLDQxMTAwMCw0MTEwMDAsNDExMDAwLDQxMTAwMCwxMDk5MDAwLDEyNTgxMDAwLDE2MDI4MDAwLDIyMzg2MDAwLDYzNDAwMCw0MTEwMDAsMTY5MDgwMDAsMjE1NzUwMDAsMzA3NTAwMCw2OTgwMDAsNjQ4MDAwLDQxMTAwMCwxMDMwODAwMCwxNzAxNTAwMCw0MTEwMDAsMTkwNTUwMDAsMjAxNDAwMCwxNjA5MzAwMCwxNzQ5NzAwMCw0MzkyMDAwLDQwMDAsMTI2MTAwMCw3NzkwMDAsODAyNTAwMCw0MTEwMDAsNDExMDAwLDEwMTgwMDAsNjI3MDAwLDE0MTYwMDAsMTU4OTMwMDAsMTk5OTUwMDAsMzMxMjAwMF0sIm9wcyI6NzIwMzk1MH1dLCJ1cGRhdGVkIjoiMjAyNS0wMy0wOVQwMDoxNToyOC42MjdaIn0%3D)

3. 高频调用函数避免使用 rest/spread 运算符,编译到 ES5 要使用循环，还要创建数组，要避免在高频场景下使用（相比正常写法相差 6 倍） [benchmark](https://perf.link/#eyJpZCI6Im5scHNodGtjZHppIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6IlwidXNlIHN0cmljdFwiO1xudmFyIF9fcmVhZCA9ICh0aGlzICYmIHRoaXMuX19yZWFkKSB8fCBmdW5jdGlvbiAobywgbikge1xuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcbiAgICBpZiAoIW0pIHJldHVybiBvO1xuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xuICAgIHRyeSB7XG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA%2BIDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxuICAgIH1cbiAgICByZXR1cm4gYXI7XG59O1xudmFyIF9fc3ByZWFkQXJyYXkgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXkpIHx8IGZ1bmN0aW9uICh0bywgZnJvbSwgcGFjaykge1xuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XG59O1xuZnVuY3Rpb24gY2FsbChhLCBiKSB7XG4gICAgYSArIGI7XG59XG5mdW5jdGlvbiBmb28oKSB7XG4gICAgdmFyIGFyZ3MgPSBbXTtcbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgfVxuICAgIGNhbGwuYXBwbHkodm9pZCAwLCBfX3NwcmVhZEFycmF5KFtdLCBfX3JlYWQoYXJncyksIGZhbHNlKSk7XG59XG5mdW5jdGlvbiBiYXIoYSwgYikge1xuICAgIGNhbGwoYSwgYik7XG59XG4iLCJ0ZXN0cyI6W3sibmFtZSI6IkZpbmQgaXRlbSAxMDAiLCJjb2RlIjoiZm9vKDEsMikiLCJydW5zIjpbMjU0MDAwLDEyMDQwMDAsMTAwMCw1ODgwMDAsOTY4MDAwLDU0ODAwMCw1NDEwMDAsMTA5MDAwMCwxNTcwMDAwLDEzMzUwMDAsMTM5MzAwMCw0MDcwMDAsOTU4MDAwLDIyMzAwMCw5OTEwMDAsNjkyMDAwLDg3MjAwMCwyMjMwMDAsNzExMDAwLDIxNDAwMCw1OTEwMDAsMTAwMCw1NDgwMDAsMTEyNDAwMCwxMjE4MDAwLDU2MTAwMCw2NjQwMDAsMTk1MDAwLDE0NzEwMDAsNTEwMDAsMTQ1ODAwMCwxMDAwLDExMjIwMDAsMTIyMDAwLDEwMDMwMDAsMTMwMTAwMCwxMzgxMDAwLDQxMjAwMCwzNzYwMDAsNDQ1MDAwLDI4NjAwMCwxMDAwLDY5MDAwMCw3MjcwMDAsNjIwMDAsODgwMDAwLDEwMDIwMDAsMTAwMDAsNjQzMDAwLDEzNjUwMDAsOTYwMDAsMTMyMDAwLDE4MTAwMCwxNjQzMDAwLDEzNTQwMDAsODIwMDAwLDIwMDAwLDExNTEwMDAsMzQwMDAwLDEyNzYwMDAsMTUwNjAwMCwxMTk2MDAwLDEwOTUwMDAsMTY3NDAwMCw1NDgwMDAsMTE0MDAwMCwxMjQ1MDAwLDEyNTAwMDAsNjQ2MDAwLDE2MTYwMDAsNTQ4MDAwLDE0MTcwMDAsMTAwMCwxMjc2MDAwLDEzOTAwMDAsNzYwMDAwLDE2MzAwMCwxMjA5MDAwLDU2MTAwMCwyMzEwMDAsMTEzODAwMCwxMzA3MDAwLDc1MTAwMCw4ODEwMDAsNDY0MDAwLDE0OTkwMDAsNzAwMCwxMDY0MDAwLDEwMDAsNDU3MDAwLDEwMDAsNjQ3MDAwLDEwMDAwMDAsMTI1NTAwMCw2MDgwMDAsNTc1MDAwLDY2NTAwMCw0MTAwMCwxMjYzMDAwLDEwMDBdLCJvcHMiOjc0NjA0MH0seyJuYW1lIjoiRmluZCBpdGVtIDIwMCIsImNvZGUiOiJiYXIoMSwyKSIsInJ1bnMiOlsyODAwMDAwLDM3NDEwMDAsODU0NDAwMCwzOTgwMDAwLDYzODIwMDAsMzAxMTAwMCwzNTk5MDAwLDU5MDcwMDAsNzMyMDAwLDQ4NDcwMDAsNjc1NzAwMCwyNDI1MDAwLDU4NDUwMDAsMzM5ODAwMCw1NDEwMDAwLDI3MzEwMDAsMjEwOTAwMCwyMjEyMDAwLDU3OTIwMDAsMTA4MTAwMCwxMjA3MDAwLDk3MjAwMCwyODYwMDAwLDI0NTQwMDAsNjU3OTAwMCwxMDExMDAwLDIxOTgwMDAsMjM4NDAwMCw4MzgwMDAwLDEzMzcwMDAsOTc2MTAwMCw5MTA0MDAwLDc1ODYwMDAsOTY3MDAwLDMwMTEwMDAsNTIzNzAwMCw5NTEzMDAwLDEwMDAsODU0NDAwMCw2NjE3MDAwLDgyNzYwMDAsNjYwMDAsMjU4MDAwMCw5MjIwMDAwLDg0MDAwLDMwMTEwMDAsNDE5ODAwMCw5MDg2MDAwLDE0NTIwMDAsOTIyNjAwMCwxNzEwMDAwLDYyMjAwMCwyMjQ3MDAwLDEwOTIyMDAwLDg1NDQwMDAsNDcxNDAwMCw5NjY2MDAwLDc1OTAwMDAsMzQ1NDAwMCw2Mzg1MDAwLDg1NDQwMDAsNzMzNjAwMCw1OTkzMDAwLDUyNjYwMDAsNDMwMDAsMjI0NjAwMCw0NDUzMDAwLDU5MzgwMDAsMTUwNDAwMCw2ODAxMDAwLDg1OTcwMDAsNDc0OTAwMCw0NjMwMDAsMTQ1MDAwLDQyNTkwMDAsMTE2MDAwLDczMTkwMDAsNjM5ODAwMCwzMDExMDAwLDEwNDcyMDAwLDU5NzAwMDAsMTk5MDAwMCw0NzA0MDAwLDExOTMwMDAsODMxNjAwMCwxMDA1NTAwMCw4NzcwMDAsNTk3MTAwMCwxMDEwMDAsMTAyNzUwMDAsNzE5MzAwMCwxMTU4MDAwLDI0MzAwMDAsMjczMzAwMCwzNjMzMDAwLDE2MjcwMDAsOTQ2MDAwMCw4OTgyMDAwLDMzMTUwMDAsMzgxMDAwXSwib3BzIjo0NTgwOTYwfV0sInVwZGF0ZWQiOiIyMDI1LTAzLTA5VDAwOjE4OjUwLjQwMFoifQ%3D%3D)，还有额外的 GC 开销

4. 手写 map 性能不如原生 [benchmark](https://perf.link/#eyJpZCI6Im5scHNodGtjZHppIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6InZhciBfX3ZhbHVlcyA9ICh0aGlzICYmIHRoaXMuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHtcbiAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xuICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pO1xuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKG8gJiYgaSA%2BPSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xufTtcbnZhciBPYmplY3RSZWNvcmRNYXAgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gT2JqZWN0UmVjb3JkTWFwKCkge1xuICAgICAgICB0aGlzLm9iamVjdEJ5S2V5ID0ge307XG4gICAgICAgIHRoaXMucmVjb3JkQnlLZXkgPSB7fTtcbiAgICB9XG4gICAgT2JqZWN0UmVjb3JkTWFwLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAob2JqZWN0LCByZWNvcmQpIHtcbiAgICAgICAgdmFyIGtleSA9IG9iamVjdC4kdXVpZDtcbiAgICAgICAgdGhpcy5vYmplY3RCeUtleVtrZXldID0gb2JqZWN0O1xuICAgICAgICB0aGlzLnJlY29yZEJ5S2V5W2tleV0gPSByZWNvcmQ7XG4gICAgfTtcbiAgICBPYmplY3RSZWNvcmRNYXAucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjb3JkQnlLZXlbb2JqZWN0LiR1dWlkXTtcbiAgICB9O1xuICAgIE9iamVjdFJlY29yZE1hcC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgICAgICBkZWxldGUgdGhpcy5vYmplY3RCeUtleVtvYmplY3QuJHV1aWRdO1xuICAgICAgICBkZWxldGUgdGhpcy5yZWNvcmRCeUtleVtvYmplY3QuJHV1aWRdO1xuICAgIH07XG4gICAgT2JqZWN0UmVjb3JkTWFwLnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBlXzEsIF9hO1xuICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMub2JqZWN0QnlLZXkpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9yICh2YXIga2V5c18xID0gX192YWx1ZXMoa2V5cyksIGtleXNfMV8xID0ga2V5c18xLm5leHQoKTsgIWtleXNfMV8xLmRvbmU7IGtleXNfMV8xID0ga2V5c18xLm5leHQoKSkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzXzFfMS52YWx1ZTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh0aGlzLnJlY29yZEJ5S2V5W2tleV0sIHRoaXMub2JqZWN0QnlLZXlba2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmIChrZXlzXzFfMSAmJiAha2V5c18xXzEuZG9uZSAmJiAoX2EgPSBrZXlzXzEucmV0dXJuKSkgX2EuY2FsbChrZXlzXzEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gT2JqZWN0UmVjb3JkTWFwO1xufSgpKTtcblxuXG5cbmNvbnN0IGl0ZW1zID0gW107XG5cbmZvciAobGV0IGkgPSAwOyBpIDwgMTAwMDsgaSsrKSB7XG4gIGl0ZW1zLnB1c2goeyckdXVpZCc6IGkudG9TdHJpbmcoKX0pO1xufVxuIiwidGVzdHMiOlt7Im5hbWUiOiJGaW5kIGl0ZW0gMTAwIiwiY29kZSI6InZhciBtYXAxID0gbmV3IE9iamVjdFJlY29yZE1hcCgpO1xuXG5pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gIG1hcDEuc2V0KGl0ZW0sIGl0ZW0pO1xufSlcblxuaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICBtYXAxLmdldChpdGVtKTtcbn0pXG5cbml0ZW1zLmZvckVhY2goKGl0ZW0pID0%2BIHtcbiAgbWFwMS5kZWxldGUoaXRlbSk7XG59KSIsInJ1bnMiOlszMDAwLDYwMDAsMjUwMCw0NTAwLDI1MDAsMjUwMCwyNTAwLDU1MDAsNDUwMCwzNTAwLDM1MDAsMjUwMCw1NTAwLDMwMDAsNDUwMCw2MDAwLDQwMDAsMzUwMCw2MDAwLDQwMDAsMjUwMCwzMDAwLDQ1MDAsNjAwMCw0NTAwLDU1MDAsNDUwMCwzMDAwLDQwMDAsNTAwMCwzMDAwLDQwMDAsMjUwMCwyNTAwLDMwMDAsNDAwMCw0MDAwLDYwMDAsNDUwMCwzNTAwLDIwMDAsNjUwMCw1MDAwLDMwMDAsNjUwMCwzMDAwLDI1MDAsNDUwMCwzNTAwLDI1MDAsMjUwMCw1NTAwLDM1MDAsNTUwMCwyNTAwLDI1MDAsNDUwMCwyNTAwLDUwMDAsMzUwMCw1NTAwLDI1MDAsNjAwMCwzNTAwLDMwMDAsNDUwMCwyMDAwLDYwMDAsNTUwMCw1NTAwLDI1MDAsNDUwMCwyNTAwLDM1MDAsMzUwMCw0MDAwLDM1MDAsMzUwMCwyMDAwLDY1MDAsMzUwMCw1NTAwLDM1MDAsNTUwMCwzMDAwLDMwMDAsMzAwMCwzMDAwLDQ1MDAsNDAwMCwyNTAwLDM1MDAsNDAwMCwyNTAwLDM1MDAsNDUwMCwyNTAwLDYwMDAsMzAwMCw0MDAwXSwib3BzIjozOTAwfSx7Im5hbWUiOiJGaW5kIGl0ZW0gMjAwIiwiY29kZSI6InZhciBtYXAyID0gbmV3IE1hcCgpO1xuXG5pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gIG1hcDIuc2V0KGl0ZW0sIGl0ZW0pO1xufSlcblxuaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICBtYXAyLmdldChpdGVtKTtcbn0pXG5cbml0ZW1zLmZvckVhY2goKGl0ZW0pID0%2BIHtcbiAgbWFwMi5kZWxldGUoaXRlbSk7XG59KSIsInJ1bnMiOls1NTAwLDEwNTAwLDYwMDAsOTUwMCw1NTAwLDEwNTAwLDU1MDAsOTAwMCw0MDAwLDcwMDAsMzAwMCw2NTAwLDkwMDAsMTE1MDAsOTUwMCwxMDUwMCw3MDAwLDY1MDAsMTA1MDAsNjAwMCw4NTAwLDcwMDAsMTAwMDAsMTA1MDAsMTA1MDAsMTA1MDAsOTAwMCw2NTAwLDgwMDAsMTA1MDAsMTA1MDAsNTUwMCw1NTAwLDIwMDAsMTA1MDAsNzAwMCw4NTAwLDEwNTAwLDY1MDAsNTAwMCwxMDUwMCwxMjAwMCwxMDAwMCwxMTUwMCwxMDUwMCw2NTAwLDEwNTAwLDUwMDAsMTA1MDAsNjAwMCwxMDUwMCw5NTAwLDEwNTAwLDEwNTAwLDEwNTAwLDUwMDAsMTAwMDAsNTAwMCw2NTAwLDEwNTAwLDEwNTAwLDU1MDAsMTEwMDAsNjAwMCw1NTAwLDkwMDAsNjAwMCwxMDUwMCwxMDUwMCw3NTAwLDExMDAwLDEwNTAwLDExMDAwLDQwMDAsNTUwMCw2NTAwLDU1MDAsNzUwMCw0MDAwLDEwNTAwLDUwMDAsNzUwMCwxMDUwMCwxMDUwMCwxMDUwMCw4NTAwLDQ1MDAsNTAwMCw4MDAwLDQ1MDAsNTAwMCw1NTAwLDgwMDAsMTA1MDAsNzAwMCwxMDAwMCwxMDUwMCw5NTAwLDUwMDAsNDAwMF0sIm9wcyI6ODA0NX1dLCJ1cGRhdGVkIjoiMjAyNS0wMy0wOVQwMDoyMDoxNC45NjVaIn0%3D)

5. 局部化极高频变量， 例如原来是 o.a.b，优化后直接访问 a [benchmark](https://perf.link/#eyJpZCI6ImNndDZzOXpvZ2ttIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6InZhciBhID0ge1xuIGI6IHtcbiBjOiAxXG4gXG4gfVxufVxuXG52YXIgZCA9IGEuYi5jIiwidGVzdHMiOlt7Im5hbWUiOiJGaW5kIGl0ZW0gMTAwIiwiY29kZSI6ImEuYi5jIiwicnVucyI6WzExNDgxMDAwLDEwMDAyMDAwLDEwMjE1MDAwLDEzNzMwMDAsMjk5NDAwMCwzMjcyMDAwLDYxMzIwMDAsNTQ5OTAwMCw4MDkxMDAwLDE3MTAwMDAsMTMyMTQwMDAsMTU1ODEwMDAsMTM3MzAwMCw3OTI1MDAwLDEzMzIwMDAwLDIxODA0MDAwLDYwMDAsMzg2MzAwMCwxMDMyODAwMCwxMzczMDAwLDI3ODIwMDAsMjgwODAwMCwzMTgyMDAwLDQ1MTIwMDAsMjE4ODUwMDAsMzM2MDAwLDQ0OTcwMDAsMTIzODAwMCwyNTE2MDAwLDMyNTIwMDAsMTkwMTAwMDAsMTM3MzAwMCwxNjAxMDAwLDI2NDEwMDAsMTM3MzAwMCwxMzczMDAwLDEyNTMxMDAwLDI0MDk3MDAwLDI0NzUwMDAsMTM3MzAwMCw1NzI0MDAwLDIyMTM2MDAwLDE3MTAwMCw1NTE4MDAwLDEyNjQwMDAsNTcwODAwMCwxNDgzMDAwLDM2NjMwMDAsMTk2MDAwMCwzNDgxMDAwLDI0MjgwMDAsMjcwMjAwMCw4Mjc1MDAwLDIzNzgxMDAwLDMxODUwMDAsMjI3OTAwMCwxMzM1MDAwLDQzNTQwMDAsMTE2OTkwMDAsMzA1ODAwMCwyMjgwMDAwLDk3MDMwMDAsNjMwMTAwMCwxMzcxOTAwMCwyMDgyMDAwMCwxNjEwMDAsNDM3MjAwMCwxNjQ1MjAwMCwyNDEzNTAwMCwyMjQ0MDAwLDEzNzMwMDAsNjcxOTAwMCwxMzk2MTAwMCwxMDcyMzAwMCwxNTgxMDAwLDMwNDgwMDAsNDQ5NDAwMCw0MjEzMDAwLDE5Mzk5MDAwLDI5NTQwMDAsNDk1NjAwMCw5NzMwMDAsMTE3NjAwMCw1OTgwMDAwLDEyOTQ3MDAwLDIzMDAwMCwzNTkwMDAwLDIxNzAwMCw2NTY3MDAwLDEwOTc1MDAwLDgyMjAwMCwxOTg0MDAwLDEzNzMwMDAsMjEwODAwMCwyNTAzMDAwLDEyMzcxMDAwLDIzNjMzMDAwLDg2OTAwMCw0MTU4MDAwLDIxNTkwMDBdLCJvcHMiOjY0Njg1ODB9LHsibmFtZSI6IkZpbmQgaXRlbSAyMDAiLCJjb2RlIjoiZCIsInJ1bnMiOls5MTAyMDAwLDEwNTczMDAwLDk4OTgwMDAsMTA1NTIwMDAsMTU3ODAwMCwyNzAxMDAwLDQ4NTEwMDAsMjk0MTAwMCw1OTk2MDAwLDE2OTEwMDAsMTI3MDQwMDAsMTQxODYwMDAsNzc5MDAwLDg3NTMwMDAsMTMwMzcwMDAsMTg2MTAwMDAsMTk2OTQwMDAsMjgxMjAwMCwxMTE3MzAwMCwxMDU5MDAwLDI0NTUwMDAsMTYyODAwMCwyODkyMDAwLDMxMDUwMDAsMjEwMjgwMDAsMjE3ODMwMDAsMzUyMjAwMCw3NTkwMDAsMTU5NDAwMCwxNTk0MDAwLDE5NTI0MDAwLDEyMDAwLDY1NjAwMCwxODc4MDAwLDM5NDAwMCw5NTMwMDAsMTA1NzYwMDAsMjIxMjcwMDAsMTU5NDAwMCwyMjY1NzAwMCwyNjQ0MDAwLDE4NDEyMDAwLDIyNDcyMDAwLDQyNTIwMDAsMjE0NjIwMDAsNDk4MzAwMCwxMDE0OTAwMCwxNTk0MDAwLDI0NjA5MDAwLDE1OTQwMDAsMTU5NDAwMCwxMjU0MDAwLDkzNjUwMDAsMjA3NDMwMDAsMTA3NjAwMCwyNjc2MDAwLDMwNzAwMCwxNTk0MDAwLDk3NTYwMDAsMTU5NDAwMCwxNjQyODAwMCwxMDIyNTAwMCw4MDc2MDAwLDEyMDIzMDAwLDIxMTYxMDAwLDE3OTI5MDAwLDM1MDQwMDAsMTU5ODYwMDAsMjMyMzEwMDAsNTg4MDAwLDIyODU3MDAwLDQxODYwMDAsMTU3MDkwMDAsOTE2MTAwMCwxMDYxMDAwLDE5MjEwMDAsMjkwNjAwMCwyNTg3MDAwLDIwMjMzMDAwLDI5MDUwMDAsMzYyNzAwMCwxNjkwMDAsMjM5MzUwMDAsNDc0NDAwMCwxNDAyNTAwMCwyMjM5NTAwMCwyNTcwMDAwLDIxMzUyMDAwLDQ4NTMwMDAsODcyNzAwMCw0MTEwMDAsMTEyNTAwMCwyMTAwMCwxNDU0MDAwLDE0MjkwMDAsMTI5ODUwMDAsMjMzMTYwMDAsMjMyODYwMDAsMzQ1NjAwMCwyMzg4MjAwMF0sIm9wcyI6ODc1OTkwMH1dLCJ1cGRhdGVkIjoiMjAyNS0wMy0wOVQwMDoyNTo1Ni40NTFaIn0%3D)

6. instanceof 的条件判断可以用 map 优化
```javascript
// setup.js
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var Origin = /** @class */ (function () {
    function Origin() {
    }
    return Origin;
}());
var Base = /** @class */ (function (_super) {
    __extends(Base, _super);
    function Base() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return Base;
}(Origin));
var A = /** @class */ (function (_super) {
    __extends(A, _super);
    function A() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return A;
}(Base));
var B = /** @class */ (function (_super) {
    __extends(B, _super);
    function B() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return B;
}(Base));
var C = /** @class */ (function (_super) {
    __extends(C, _super);
    function C() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return C;
}(Base));
var D = /** @class */ (function (_super) {
    __extends(D, _super);
    function D() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return D;
}(Base));
var E = /** @class */ (function (_super) {
    __extends(E, _super);
    function E() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return E;
}(Base));
var F = /** @class */ (function (_super) {
    __extends(F, _super);
    function F() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return F;
}(Base));
var list = [];
for (var i = 0; i < 1000; i++) {
    list.push(new D());
}
function a() {}
function b() {}
function c() {}
function d() {}
function e() {}
function f() {}
const HANDLER_BY_CONSTRUCTOR = new Map([
	[A, a],
	[B, b],
	[C, c],
	[D, d],
	[E, e],
	[F, f]
]);

function getCommonElementCreator(element) {
    // 对于大多数单层继承的类，使用更快的方法
    if (HANDLER_BY_CONSTRUCTOR.get(element.constructor) !== undefined) {
        return HANDLER_BY_CONSTRUCTOR.get(element.constructor);
    }
    // 其他情况使用循环查找
    let prototype = Object.getPrototypeOf(Object.getPrototypeOf(element));

    while (prototype && prototype !== Base.prototype) {
        const elementType = HANDLER_BY_CONSTRUCTOR.get(prototype.constructor);
        if (elementType !== undefined) {
            return elementType;
        }
        prototype = Object.getPrototypeOf(prototype);
    }
    return;
}

// case 1
list.forEach(function (element) {
    if (element instanceof A) {
    	a();
    }
    else if (element instanceof B) {
    	b();
    }
    else if (element instanceof C) {
    	c();
    }
    else if (element instanceof D) {
    	d();
    }
    else if (element instanceof E) {
    	e();
    }
    else if (element instanceof F) {
    	f();
    }
});

// case 2
list.forEach(function (element) {
    const handler = getCommonElementCreator(element);
    
    if (handler)(
    	handler()
    )
});

```

7. ES6 的迭代器经过编译性能都很差，而且 helper 函数会创建多余的数组，造成 GC 开销。

-  遍历数组: TS 编译的 for of 循环比 for 循环和 forEach 慢了 70% 和 50% [benchmark](https://perf.link/#eyJpZCI6Imh2aTdyczIwNXdlIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6InZhciB0ZXN0RGF0YSA9IFtdXG5mb3IgKHZhciBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gIHRlc3REYXRhLnB1c2goaSlcbn1cbnZhciBfX3ZhbHVlcyA9ICh0aGlzICYmIHRoaXMuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHtcbiAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xuICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pO1xuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKG8gJiYgaSA%2BPSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xufTsiLCJ0ZXN0cyI6W3sibmFtZSI6IlRlc3QgQ2FzZSIsImNvZGUiOiJ2YXIgZV8xLCBfYTtcbnZhciByZXMgPSAwO1xudHJ5IHtcbiAgICBmb3IgKHZhciB0ZXN0RGF0YV8xID0gX192YWx1ZXModGVzdERhdGEpLCB0ZXN0RGF0YV8xXzEgPSB0ZXN0RGF0YV8xLm5leHQoKTsgIXRlc3REYXRhXzFfMS5kb25lOyB0ZXN0RGF0YV8xXzEgPSB0ZXN0RGF0YV8xLm5leHQoKSkge1xuICAgICAgICB2YXIgdiA9IHRlc3REYXRhXzFfMS52YWx1ZTtcbiAgICAgICAgcmVzICs9IHY7XG4gICAgfVxufVxuY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH1cbmZpbmFsbHkge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICh0ZXN0RGF0YV8xXzEgJiYgIXRlc3REYXRhXzFfMS5kb25lICYmIChfYSA9IHRlc3REYXRhXzEucmV0dXJuKSkgX2EuY2FsbCh0ZXN0RGF0YV8xKTtcbiAgICB9XG4gICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfVxufSIsInJ1bnMiOlsyMDcwMDAsMTg4MDAwLDM5MDAwLDI0ODAwMCw1NzAwMCw0MzAwMCwzMzAwMCwxODAwMCwzMjIwMDAsNTIwMDAsNjUwMDAsODAwMCw1OTAwMCwxMDAwLDkyMDAwLDI3NzAwMCw1MjAwMCw3MzAwMCwxNjkwMDAsMjA5MDAwLDEzMjAwMCwzMDQwMDAsNzUwMDAsMTI3MDAwLDEwMDAwLDI0MzAwMCw4NzAwMCwxNDMwMDAsMTU3MDAwLDkzMDAwLDIwMDAsMjEyMDAwLDI3MDAwLDI3MjAwMCwxMDAwLDE0NDAwMCwxOTAwMCwyNzIwMDAsMTA4MDAwLDI3MjAwMCw0ODAwMCwyOTIwMDAsMTEzMDAwLDExODAwMCwxNTMwMDAsNjkwMDAsMTYyMDAwLDIwMzAwMCwxMjIwMDAsMjcyMDAwLDUzMDAwLDEwMDAsNzEwMDAsMjEwMDAwLDEwMDAsMTcwMDAsMjQwMDAsNDQwMDAsNzAwMCwxMDAwLDE4MzAwMCwxMDAwLDIzNDAwMCwxNTUwMDAsMTAwMCwyMDgwMDAsMTY1MDAwLDI3MjAwMCwxMTUwMDAsMTM1MDAwLDEzODAwMCwxNDMwMDAsMjgyMDAwLDI5ODAwMCw3NTAwMCwyNzIwMDAsMjQ4MDAwLDQzMDAwLDEzNjAwMCwyNzYwMDAsMjcxMDAwLDI2MDAwMCwyMjMwMDAsNTUwMDAsMTAwMCwyNTMwMDAsMjcwMDAsMjcyMDAwLDE4MzAwMCwxOTAwMDAsNzAwMCwxODEwMDAsMzkwMDAsODUwMDAsMjI1MDAwLDI1MTAwMCwyNTgwMDAsMjIyMDAwLDE5ODAwMCw2MDAwXSwib3BzIjoxMzQ4MDB9LHsibmFtZSI6IkZpbmQgaXRlbSAxMDAiLCJjb2RlIjoidmFyIHJlcyA9IDA7XG50ZXN0RGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHgpIHtcbiAgcmVzICs9IHhcbn0pIiwicnVucyI6Wzk2MDAwLDI3ODAwMCw1ODIwMDAsODk2MDAwLDcwMDAwMCwyNDIwMDAsNzgwMDAsMTk5MDAwLDk0OTAwMCw0MzMwMDAsMTU1MDAwLDQzMjAwMCw1MDAwMCw2NTIwMDAsMTQwMDAsOTg0MDAwLDUyMTAwMCwxMTIwMDAsNDQ4MDAwLDg3ODAwMCwyOTkwMDAsMzMzMDAwLDc2MDAwMCwzMTAwMDAsNTcxMDAwLDg4ODAwMCwxMjc0MDAwLDIyMTAwMCwzMTAwMCwyMjIwMDAsNzc3MDAwLDEyMzIwMDAsMTAyODAwMCwxMDU3MDAwLDg0NjAwMCw2NzAwMCw0NjAwMCwxODQwMDAsMTkzMDAwLDY2ODAwMCwyNzAwMCwzNzUwMDAsMTMyNTAwMCwxMDA5MDAwLDE5MzAwMCwyNzAwMCwxNjAwMCw1NjgwMDAsMjY2MDAwLDY4MjAwMCwxMTgwMDAsMjU2MDAwLDE0OTAwMCw3NzQwMDAsODAwMDAwLDgwMTAwMCw1MTAwMCwyMjQwMDAsNjUwMDAwLDEwMDUwMDAsMjYwMDAsODMyMDAwLDg2MDAwMCw1NDAwMCwxMTAwMCwyOTEwMDAsNDAwMDAsMTE3OTAwMCw3NDYwMDAsMTI0MDAwLDM4MzAwMCw5NDAwMCw1MjcwMDAsNjA3MDAwLDU2NjAwMCw3OTMwMDAsMjM0MDAwLDgzNTAwMCwyNTAwMDAsMzMwMDAwLDgwMDAsNzUwMDAsOTIwMDAsMzUwMDAsOTMxMDAwLDEwMDcwMDAsODIyMDAwLDc2OTAwMCwyNjkwMDAsNDgzMDAwLDMxMDAwLDExNzIwMDAsNzc0MDAwLDIxODAwMCwxODEwMDAsNzY4MDAwLDg3MzAwMCw4NTAwMCwyNjkwMDAsNzE3MDAwXSwib3BzIjo0NzM4MzB9LHsibmFtZSI6IkZpbmQgaXRlbSAyMDAiLCJjb2RlIjoidmFyIHJlcyA9IDBcbmZvciAodmFyIGkgPSAwOyBpIDwgdGVzdERhdGEubGVuZ3RoOyBpKyspIHtcbiAgcmVzICs9IHRlc3REYXRhW2ldXG59IiwicnVucyI6WzEwMDAsODA0MDAwLDQ2OTAwMCw0NjcwMDAsNDI3MDAwLDE0MjAwMCw3NDAwMCwxNDgwMDAsMTM2MDAwLDIzMTAwMCw3ODAwMCwyODkwMDAsNjAwMDAsMTIxMDAwLDQ1OTAwMCw0MzEwMDAsMzg4MDAwLDY0MDAwLDYwMDAwLDU4NjAwMCwxNzMwMDAsMTIxMDAwLDEyMTAwMCwxNzkwMDAsMTIxMDAwLDE1NDAwMCwzOTQwMDAsMTAwMDAsMTIxMDAwLDEwMzAwMCwyMzMwMDAsNzkwMDAwLDU0MjAwMCw2OTMwMDAsMzk0MDAwLDMzNjAwMCw3NzcwMDAsMTIxMDAwLDY4OTAwMCwzMTYwMDAsMzEwMDAsMTk1MDAwLDEyMTAwMCwzMTQwMDAsMTI4MDAwLDIxNjAwMCw3MzcwMDAsMTc0MDAwLDEyMTAwMCwxNzcwMDAsMTEwMDAwLDE3NzAwMCwzNzAwMDAsNTIxMDAwLDYxMDAwLDg1NTAwMCw4MjgwMDAsMTQ0MDAwLDgwNDAwMCwyMDIwMDAsNjIzMDAwLDcxMTAwMCwxMzEwMDAsNDk4MDAwLDY4MDAwMCw0MDAwLDgwNTAwMCw4MjIwMDAsMzk4MDAwLDEwMDAsMjgzMDAwLDUxNDAwMCwyMTYwMDAsMzIyMDAwLDQ1MDAwMCwxMDUwMDAsMTIxMDAwLDEzNDAwMCwxNzQwMDAsNTkwMDAsNjAwMCw2MDAwMDAsNjMxMDAwLDM0MDAwMCwxNzYwMDAsNjQyMDAwLDM5MjAwMCwxMzIwMDAsMTIxMDAwLDg4MDAwLDYwODAwMCw3MzAwMDAsMTE4MDAwLDE0MTAwMCwxMjEwMDAsNTI4MDAwLDEyMTAwMCw4OTAwMCw5MTAwMCwzMzYwMDBdLCJvcHMiOjMxMTcxMH1dLCJ1cGRhdGVkIjoiMjAyNS0wMy0wOVQwMDozMzoxMS4zODBaIn0%3D)

- 多元素 push 到数组: TS 编译的比 Array.prototype.push.apply 慢了 90%，即 a.push(...b) 和 Array.prototype.push.apply(a, b) 的差别。[benchmark](https://perf.link/#eyJpZCI6Imh2aTdyczIwNXdlIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6IlwidXNlIHN0cmljdFwiO1xudmFyIF9fcmVhZCA9ICh0aGlzICYmIHRoaXMuX19yZWFkKSB8fCBmdW5jdGlvbiAobywgbikge1xuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcbiAgICBpZiAoIW0pIHJldHVybiBvO1xuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xuICAgIHRyeSB7XG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA%2BIDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxuICAgIH1cbiAgICByZXR1cm4gYXI7XG59O1xudmFyIF9fc3ByZWFkQXJyYXkgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXkpIHx8IGZ1bmN0aW9uICh0bywgZnJvbSwgcGFjaykge1xuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XG59O1xudmFyIGEgPSBbXTtcbmZvciAodmFyIGkgPSAwOyBpIDwgNTAwOyBpKyspIHtcbiAgICBhLnB1c2goaSk7XG59XG4iLCJ0ZXN0cyI6W3sibmFtZSI6IkZpbmQgaXRlbSAxMDAiLCJjb2RlIjoidmFyIGMgPSBbXS5wdXNoLmFwcGx5KFtdLCBfX3NwcmVhZEFycmF5KFtdLCBfX3JlYWQoYSksIGZhbHNlKSk7IiwicnVucyI6WzIyMDAwLDQwMDAsMjEwMDAsOTAwMCwxNjAwMCwxMjAwMCw4MDAwLDEzMDAwLDE2MDAwLDkwMDAsMjEwMDAsMjAwMCwxOTAwMCwzNDAwMCwxMDAwMCwyNTAwMCwxNjAwMCwzNjAwMCwxNDAwMCwyNTAwMCwxNjAwMCwyMTAwMCwxMDAwLDE3MDAwLDM2MDAwLDI0MDAwLDEyMDAwLDM5MDAwLDI4MDAwLDIwMDAsMzUwMDAsMjUwMDAsMjYwMDAsMjUwMDAsMjIwMDAsMTQwMDAsMTkwMDAsMzMwMDAsMjkwMDAsMjUwMDAsMzcwMDAsMjgwMDAsNjAwMCwxMDAwLDIwMDAsMjIwMDAsMjgwMDAsMTcwMDAsMzQwMDAsMTMwMDAsMTMwMDAsMTgwMDAsMTMwMDAsMTkwMDAsMzQwMDAsMTYwMDAsMTAwMCwxOTAwMCwyNzAwMCwxNDAwMCwyNTAwMCwzMDAwLDIwMDAwLDM2MDAwLDE4MDAwLDEwMDAsMzAwMDAsMTAwMCwyMjAwMCwzODAwMCwxODAwMCw4MDAwLDEzMDAwLDcwMDAsMTAwMCw5MDAwLDI2MDAwLDE1MDAwLDI0MDAwLDE4MDAwLDE5MDAwLDMyMDAwLDEwMDAwLDEyMDAwLDYwMDAsMTcwMDAsMjAwMDAsMTAwMCwyMzAwMCwyNTAwMCwyMjAwMCwzNDAwMCwyMDAwLDcwMDAsMTAwMDAsMzAwMCwxMDAwLDEwMDAsMTYwMDAsMzQwMDBdLCJvcHMiOjE3NzEwfSx7Im5hbWUiOiJGaW5kIGl0ZW0gMjAwIiwiY29kZSI6InZhciBkID0gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoW10sIGEpOyIsInJ1bnMiOlsyMjMwMDAsNDM1MDAwLDEyOTAwMCwzOTcwMDAsODIwMDAsMTUxMDAwLDM5OTAwMCwxODMwMDAsMjg1MDAwLDUzMDAwLDE1MDAwLDg4MDAwLDEyNTAwMCwxODAwMDAsNDAyMDAwLDI5MzAwMCwxNjQwMDAsMzE4MDAwLDExNTAwMCwxNjUwMDAsMjIzMDAwLDIxNDAwMCw0MTkwMDAsMjAxMDAwLDMyNDAwMCwyODgwMDAsMTA0MDAwLDMwMzAwMCwzMzMwMDAsMTMwMDAsMzU0MDAwLDMwMzAwMCwxMTIwMDAsMzAzMDAwLDI2NDAwMCwyNDUwMDAsMzIwMDAsMzAzMDAwLDMzMDAwMCwyOTkwMDAsMzk2MDAwLDMwMzAwMCwxMjMwMDAsNDQ4MDAwLDQ5MDAwMCw0ODUwMDAsMjc3MDAwLDI2NTAwMCwxNTQwMDAsMjIzMDAwLDIzNzAwMCw1OTAwMCwzNjQwMDAsMTI3MDAwLDQ1MjAwMCwzNTAwMCw0ODIwMDAsMjU2MDAwLDI1NjAwMCwzNzQwMDAsMzAzMDAwLDg4MDAwLDI1NzAwMCwzMDMwMDAsMzgzMDAwLDM3OTAwMCwzNjMwMDAsMzYxMDAwLDMyOTAwMCwzMDMwMDAsMTgwMDAsMzAzMDAwLDE2MjAwMCwxMzMwMDAsMzAzMDAwLDEwOTAwMCwxODQwMDAsMjM3MDAwLDMzNjAwMCw0ODMwMDAsNTYwMDAsNDUwMDAwLDQ3MDAwLDE4MzAwMCw3MzAwMCw4MjAwMCwyMTIwMDAsMjMwMDAsMjIzMDAwLDEyMDAwLDIyMDAwLDQ5MzAwMCwyNDAwMCwzNjUwMDAsMTA3MDAwLDM1ODAwMCw0MDAwMCwzNTcwMDAsMjQ5MDAwLDQ3NTAwMF0sIm9wcyI6MjQxNjMwfV0sInVwZGF0ZWQiOiIyMDI1LTAzLTA5VDAwOjM1OjIyLjc0OVoifQ%3D%3D)

- 数组拼接：[...a, ...b] 比 a.concat(b) 慢了 95% [benchmark](https://perf.link/#eyJpZCI6ImVkZGF1ZjI2ZnBwIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6IlwidXNlIHN0cmljdFwiO1xudmFyIF9fcmVhZCA9ICh0aGlzICYmIHRoaXMuX19yZWFkKSB8fCBmdW5jdGlvbiAobywgbikge1xuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcbiAgICBpZiAoIW0pIHJldHVybiBvO1xuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xuICAgIHRyeSB7XG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA%2BIDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxuICAgIH1cbiAgICByZXR1cm4gYXI7XG59O1xudmFyIF9fc3ByZWFkQXJyYXkgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXkpIHx8IGZ1bmN0aW9uICh0bywgZnJvbSwgcGFjaykge1xuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XG59O1xudmFyIGEgPSBbXTtcbnZhciBiID0gW107XG5mb3IgKHZhciBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgYS5wdXNoKGkpO1xuICAgIGIucHVzaChpKTtcbn0iLCJ0ZXN0cyI6W3sibmFtZSI6IkZpbmQgaXRlbSA0MDAiLCJjb2RlIjoidmFyIGMgPSBfX3NwcmVhZEFycmF5KF9fc3ByZWFkQXJyYXkoW10sIF9fcmVhZChhKSwgZmFsc2UpLCBfX3JlYWQoYiksIGZhbHNlKTsiLCJydW5zIjpbNjQwMDAsNzIwMDAsNjcwMDAsODQwMDAsNTMwMDAsMjkwMDAsNDMwMDAsOTcwMDAsMTAxMDAwLDE5MDAwLDUxMDAwLDI0MDAwLDk3MDAwLDc4MDAwLDIzMDAwLDYwMDAwLDYxMDAwLDgwMDAsNDEwMDAsOTMwMDAsMTUwMDAsNjkwMDAsOTgwMDAsMjkwMDAsNzgwMDAsMTAwMDAsNTkwMDAsNTEwMDAsNzEwMDAsMjMwMDAsODQwMDAsNDAwMCwxMDAwLDU3MDAwLDE4MDAwLDY5MDAwLDEwMDAsNTkwMDAsMjMwMDAsNTEwMDAsMjgwMDAsNjMwMDAsMTMwMDAsMTQwMDAsNzcwMDAsMTAwMCwyNTAwMCw4MzAwMCwyMDAwLDQ0MDAwLDQxMDAwLDU1MDAwLDg1MDAwLDIxMDAwLDU2MDAwLDc1MDAwLDQ5MDAwLDE4MDAwLDQzMDAwLDY1MDAwLDMzMDAwLDI3MDAwLDYyMDAwLDU5MDAwLDIwMDAsODcwMDAsNTkwMDAsMjAwMCw1OTAwMCw1MTAwMCwzNzAwMCw4MTAwMCwxNDAwMCw4MDAwLDU5MDAwLDI3MDAwLDE2MDAwLDgxMDAwLDIxMDAwLDE4MDAwLDU5MDAwLDgxMDAwLDEwMjAwMCwzNzAwMCwyNzAwMCwyNTAwMCw2MzAwMCwxMDAwLDY0MDAwLDE5MDAwLDMyMDAwLDgwMDAwLDI0MDAwLDkyMDAwLDMyMDAwLDg2MDAwLDEzMDAwLDYwMDAsNTUwMDAsODkwMDBdLCJvcHMiOjQ2ODMwfSx7Im5hbWUiOiJGaW5kIGl0ZW0gODAwIiwiY29kZSI6InZhciBkID0gYS5jb25jYXQoYik7IiwicnVucyI6Wzg5MDAwMCwxMjU0MDAwLDEzODQwMDAsMTYxNTAwMCwxMjI4MDAwLDU5MjAwMCwxMTM1MDAwLDE5ODUwMDAsMTU3NTAwMCwzNDUwMDAsMTEzNTAwMCwzNzcwMDAsMjAxNzAwMCwxODQ0MDAwLDIxNTEwMDAsMTEzNTAwMCwxMDcxMDAwLDM0MDAwLDcyMDAwMCwxNzU3MDAwLDUxNDAwMCwxNTY1MDAwLDE2MDAwMDAsMTk3MDAwMCwxMTM1MDAwLDE5MjcwMDAsMzQ4MDAwLDExMzUwMDAsOTQ5MDAwLDgwMTAwMCwxMzUxMDAwLDgyMzAwMCwyMDE3MDAwLDExMzIwMDAsMTU4NDAwMCwxMTYzMDAwLDIwODgwMDAsMTEzNTAwMCw4MTcwMDAsMTEzNTAwMCw1NzIwMDAsMTE5ODAwMCw1MDAwLDE2NzcwMDAsMTQ0NzAwMCwyMTkwMDAsMTc2MDAwMCwxNDg4MDAwLDg5MDAwLDk1OTAwMCw4MTYwMDAsOTE5MDAwLDE1MDAwMCw4MTIwMDAsMTEzNTAwMCwxMjc3MDAwLDEwNDkwMDAsNjgxMDAwLDU1MzAwMCwxMTc3MDAwLDU4NjAwMCw5MDAwMDAsMTE2OTAwMCwxMTM1MDAwLDE5MzgwMDAsMTYxOTAwMCwxMTM5MDAwLDIwODAwMCwxMTM1MDAwLDI5OTAwMCwxMDEyMDAwLDE0MjgwMDAsNTQzMDAwLDI3OTAwMCwxMTM1MDAwLDY0MDAwLDE4MjQwMDAsMTUxMTAwMCw4MTIwMDAsNDA2MDAwLDExMzUwMDAsMTU4NjAwMCwxNjcxMDAwLDQzNjAwMCw5MTAwMDAsMTYzMDAwMCwxMTM1MDAwLDE5NjUwMDAsMTIzNjAwMCwwLDYyNTAwMCwxMTUzMDAwLDMxNTAwMCwyMjMwMDAwLDc0ODAwMCwxNTQzMDAwLDE5NzAwMCwyMTM5MDAwLDExMzUwMDAsMTEzNTAwMF0sIm9wcyI6MTA5NDgyMH1dLCJ1cGRhdGVkIjoiMjAyNS0wMy0wOVQwMDozNjo1My4wODhaIn0%3D)

- 数组复制：[...a] 比 a.slice() 慢了 95% [benchmark](https://perf.link/#eyJpZCI6ImVkZGF1ZjI2ZnBwIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6InZhciBfX3JlYWQgPSAodGhpcyAmJiB0aGlzLl9fcmVhZCkgfHwgZnVuY3Rpb24gKG8sIG4pIHtcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XG4gICAgaWYgKCFtKSByZXR1cm4gbztcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcbiAgICB0cnkge1xuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cbiAgICB9XG4gICAgcmV0dXJuIGFyO1xufTtcbnZhciBfX3NwcmVhZEFycmF5ID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5KSB8fCBmdW5jdGlvbiAodG8sIGZyb20sIHBhY2spIHtcbiAgICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykge1xuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xuICAgICAgICAgICAgYXJbaV0gPSBmcm9tW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpO1xufTtcbnZhciBhID0gW107XG5mb3IgKHZhciBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgYS5wdXNoKGkpO1xufSIsInRlc3RzIjpbeyJuYW1lIjoiRmluZCBpdGVtIDQwMCIsImNvZGUiOiJ2YXIgYyA9IF9fc3ByZWFkQXJyYXkoW10sIF9fcmVhZChhKSwgZmFsc2UpOyIsInJ1bnMiOlsxNzMwMDAsNzkwMDAsOTYwMDAsMTIwMDAwLDExMjAwMCw1MDAwLDY3MDAwLDU0MDAwLDk4MDAwLDM5MDAwLDU2MDAwLDEwMDAsMTYxMDAwLDEzNTAwMCw5MzAwMCwxNTIwMDAsMTQ2MDAwLDY0MDAwLDEwMDAwMCw2MjAwMCwxNjQwMDAsMzYwMDAsMTAwMCwxMjMwMDAsMTgzMDAwLDUwMDAwLDExMjAwMCwxNDIwMDAsMTcwMDAsMTU4MDAwLDkzMDAwLDEwMDAsMTgxMDAwLDQyMDAwLDEzODAwMCw0OTAwMCwxNzMwMDAsMTQxMDAwLDc4MDAwLDg1MDAwLDExODAwMCw5NzAwMCwxMDkwMDAsNzUwMDAsMTM1MDAwLDEzMjAwMCw5MzAwMCwxNTMwMDAsMTE4MDAwLDY0MDAwLDE0NTAwMCwxNDAwMDAsOTEwMDAsMTY3MDAwLDExNTAwMCwxMjgwMDAsMTE4MDAwLDMwMDAwLDkzMDAwLDE0NTAwMCw5NTAwMCwxNzIwMDAsOTQwMDAsMTQ3MDAwLDE5MDAwLDEyMDAwMCwxNTAwMDAsMTI0MDAwLDk5MDAwLDEzODAwMCw5MDAwMCwxMTgwMDAsMTM2MDAwLDEwMDAsMTcxMDAwLDM2MDAwLDEwMDAsMTg0MDAwLDk4MDAwLDEwNDAwMCw0NDAwMCwxMTgwMDAsOTMwMDAsMTE0MDAwLDE2MzAwMCwxMDcwMDAsMTY3MDAwLDgzMDAwLDEzMzAwMCwxMzEwMDAsNTYwMDAsODEwMDAsMTExMDAwLDEyNjAwMCwxMDkwMDAsMTA4MDAwLDE0NjAwMCwxMjIwMDAsMTQwMDAsMTE4MDAwXSwib3BzIjoxMDI4NzB9LHsibmFtZSI6IkZpbmQgaXRlbSA4MDAiLCJjb2RlIjoidmFyIGQgPSBhLnNsaWNlKCkiLCJydW5zIjpbMzE1NTAwMCwyMTY4MDAwLDE1OTYwMDAsMjE3NzAwMCwyMTgzMDAwLDI3ODQwMDAsNjY4MDAwLDUwODAwMCwxMjc3MDAwLDI2NjAwMCwyMTc3MDAwLDMzNDkwMDAsMjU1NjAwMCwzNTc1MDAwLDIxODAwMCwxODQ1MDAwLDI1MzAwMCwyMDAwMCwxODc3MDAwLDE5OTkwMDAsMjgyNzAwMCw2NTAwMDAsMzQ5NzAwMCwyMTc3MDAwLDM4MzMwMDAsNzkwMDAwLDIwMzYwMDAsMzAxODAwMCw3ODMwMDAsMjU4ODAwMCwyMDM2MDAwLDE1MjAwMCwyMTc3MDAwLDE0ODQwMDAsMjE3NzAwMCwxNjk4MDAwLDI3MjMwMDAsMjIzODAwMCwxODU0MDAwLDM0MzAwMCwyMTc3MDAwLDMyODAwMDAsMjE0MDAwMCwxNDM5MDAwLDIyNTgwMDAsMjYyNTAwMCw0MDg4MDAwLDI1OTMwMDAsOTUwMDAwLDI2NjAwMCwyMTc3MDAwLDMwMTUwMDAsMjEwNzAwMCwyNjM5MDAwLDIxNzcwMDAsMTcyMTAwMCwyMTc3MDAwLDExNTQwMDAsMTg2NzAwMCwyOTYwMDAwLDMzMTAwMCwzMDcyMDAwLDIxNzcwMDAsMTI0MzAwMCw0NzUwMDAsMjE3NzAwMCwyNDI4MDAwLDQzNDAwMDAsMTYzMjAwMCwyMTc3MDAwLDIxNzcwMDAsMjA3ODAwMCwyMTc3MDAwLDM1NzEwMDAsMTkyNTAwMCwxMTk4MDAwLDM2ODQwMDAsMjE3NzAwMCwzNzU0MDAwLDIxNzcwMDAsMTQ3NDAwMCwyNDE0MDAwLDE1MzIwMDAsNTgwMDAsMzQxNjAwMCwyNTA3MDAwLDM1ODMwMDAsMzk0ODAwMCwyNDY2MDAwLDI1NzgwMDAsOTIwMDAwLDk1OTAwMCwyMTc3MDAwLDIxNzcwMDAsMjE0NDAwMCwyMjEyMDAwLDIzNjUwMDAsMjE3NzAwMCwzNTI0MDAwLDIxNzcwMDBdLCJvcHMiOjIwNzMyMDB9XSwidXBkYXRlZCI6IjIwMjUtMDMtMDlUMDA6Mzc6MzYuMTEyWiJ9)

- Set 转换到 Array：TS 编译的比 Array.from 慢了 95%，即 [...set] 和 Array.from(set) 的差别 [benchmark](https://perf.link/#eyJpZCI6Imh2aTdyczIwNXdlIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6IlwidXNlIHN0cmljdFwiO1xudmFyIF9fcmVhZCA9ICh0aGlzICYmIHRoaXMuX19yZWFkKSB8fCBmdW5jdGlvbiAobywgbikge1xuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcbiAgICBpZiAoIW0pIHJldHVybiBvO1xuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xuICAgIHRyeSB7XG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA%2BIDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxuICAgIH1cbiAgICByZXR1cm4gYXI7XG59O1xudmFyIF9fc3ByZWFkQXJyYXkgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXkpIHx8IGZ1bmN0aW9uICh0bywgZnJvbSwgcGFjaykge1xuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XG59O1xudmFyIGEgPSBuZXcgU2V0KCk7XG5mb3IgKHZhciBpID0gMDsgaSA8IDUwMDsgaSsrKSB7XG4gICAgYS5hZGQoaSk7XG59XG4iLCJ0ZXN0cyI6W3sibmFtZSI6IkZpbmQgaXRlbSAxMDAiLCJjb2RlIjoidmFyIGMgPSBfX3NwcmVhZEFycmF5KFtdLCBfX3JlYWQoYSksIGZhbHNlKTsiLCJydW5zIjpbMTQwMDAsMTcwMDAsMTMwMDAsMjAwMDAsNjAwMCwxMTAwMCwyNTAwMCwzNzAwMCw0MzAwMCwxNzAwMCwyNTAwMCwxNzAwMCwxMjAwMCwzOTAwMCw4MDAwLDE1MDAwLDIwMDAwLDEwMDAwLDQzMDAwLDkwMDAsMzgwMDAsMTQwMDAsMTUwMDAsMjUwMDAsMjUwMDAsMjUwMDAsMjUwMDAsMzMwMDAsMjQwMDAsMTcwMDAsNDIwMDAsMjUwMDAsMTIwMDAsMTAwMCwyMDAwLDI3MDAwLDI0MDAwLDEwMDAsMjAwMDAsMzYwMDAsNDAwMDAsMTcwMDAsMjQwMDAsMjUwMDAsMzQwMDAsMTAwMDAsMzUwMDAsMjQwMDAsODAwMCwxMDAwLDE4MDAwLDIzMDAwLDM3MDAwLDE4MDAwLDI1MDAwLDI1MDAwLDE4MDAwLDM3MDAwLDM0MDAwLDIzMDAwLDM2MDAwLDMwMDAwLDExMDAwLDI2MDAwLDMwMDAwLDMyMDAwLDE2MDAwLDM1MDAwLDQwMDAwLDgwMDAsMTAwMCw0MDAwLDM0MDAwLDMxMDAwLDQxMDAwLDIwMDAsMTAwMCw1MDAwLDMyMDAwLDEyMDAwLDMxMDAwLDUwMDAsMjcwMDAsMjcwMDAsMTUwMDAsMjEwMDAsNDAwMDAsMjUwMDAsMjIwMDAsMjgwMDAsMzMwMDAsMzIwMDAsMzQwMDAsMjUwMDAsMjUwMDAsMzUwMDAsMjAwMDAsNjAwMCwxMDAwLDEwMDBdLCJvcHMiOjIxODgwfSx7Im5hbWUiOiJGaW5kIGl0ZW0gMjAwIiwiY29kZSI6InZhciBkID0gQXJyYXkuZnJvbShhKTsiLCJydW5zIjpbMTU0MDAwLDM5NzAwMCwxODcwMDAsNDUxMDAwLDE1NjAwMCwxNDMwMDAsNTYyMDAwLDU4MjAwMCw0ODcwMDAsMTE5MDAwLDQzMDAwMCwzNzEwMDAsMzE4MDAwLDc1NDAwMCw3MDAwMCwxOTkwMDAsNDYxMDAwLDE4MDAwLDQ2MTAwMCw0NzAwMCw0NjEwMDAsMjk0MDAwLDM2MTAwMCwzNzIwMDAsNDMxMDAwLDQ1MDAwLDQ2MTAwMCw0NjEwMDAsMTg1MDAwLDM2NzAwMCw1NzIwMDAsNDEyMDAwLDE3NTAwMCw0NjEwMDAsNzEwMDAwLDQ2MTAwMCwyOTcwMDAsNDYxMDAwLDIxNjAwMCw0NjEwMDAsNDYxMDAwLDM0ODAwMCw0MzYwMDAsMjk1MDAwLDYxNDAwMCw1NTAwMCw0NjEwMDAsNDYxMDAwLDcyODAwMCw1NTcwMDAsNDMzMDAwLDMzNzAwMCwzMTcwMDAsNDA5MDAwLDQ2MTAwMCwzODQwMDAsMzExMDAwLDUxMTAwMCw0NjEwMDAsNDUzMDAwLDQ2MTAwMCw0NjEwMDAsMjEzMDAwLDQ2MTAwMCw0MzQwMDAsNDYxMDAwLDIyOTAwMCw0NjEwMDAsNDYxMDAwLDEyMjAwMCw0ODQwMDAsNDYxMDAwLDYyMjAwMCwzNDAwMDAsNDYxMDAwLDYzMzAwMCw0NjEwMDAsNjA4MDAwLDMxNDAwMCw4MTAwMCw0NjEwMDAsNTAwMDAsNDYxMDAwLDM2OTAwMCwxODAwMCwyMTgwMDAsNDYxMDAwLDI1MDAwMCw0MDMwMDAsNDQ3MDAwLDQ2MTAwMCw0NTUwMDAsMzI4MDAwLDM4OTAwMCw0NDkwMDAsNDYxMDAwLDQ2MTAwMCwxMTAwMDAsNTAxMDAwLDUzNjAwMF0sIm9wcyI6MzgwNDIwfV0sInVwZGF0ZWQiOiIyMDI1LTAzLTA5VDAwOjM4OjM4LjExNloifQ%3D%3D)

- 遍历 Map: forEach 比 for of 快 50% [benchmark](https://perf.link/#eyJpZCI6Imh2aTdyczIwNXdlIiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6InZhciBfX3ZhbHVlcyA9ICh0aGlzICYmIHRoaXMuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHtcbiAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xuICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pO1xuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKG8gJiYgaSA%2BPSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xufTtcbnZhciBlXzEsIF9hO1xudmFyIG1hcCA9IG5ldyBNYXAoKTtcbmZvciAodmFyIGkgPSAwOyBpIDwgMTAwMDsgaSsrKSB7XG4gICAgbWFwLnNldChpLCBpKTtcbn0iLCJ0ZXN0cyI6W3sibmFtZSI6IkZpbmQgaXRlbSAxMDAiLCJjb2RlIjoidmFyIHJlc3VsdCA9IDA7XG50cnkge1xuICAgIGZvciAodmFyIF9iID0gX192YWx1ZXMobWFwLnZhbHVlcygpKSwgX2MgPSBfYi5uZXh0KCk7ICFfYy5kb25lOyBfYyA9IF9iLm5leHQoKSkge1xuICAgICAgICB2YXIgdmFsdWUgPSBfYy52YWx1ZTtcbiAgICAgICAgcmVzdWx0ICs9IHZhbHVlO1xuICAgIH1cbn1cbmNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9XG5maW5hbGx5IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7XG4gICAgfVxuICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH1cbn0iLCJydW5zIjpbMzIwMDAsMzAwMCwyMDAwLDMxMDAwLDIxMDAwLDUwMDAsMjIwMDAsMjMwMDAsODAwMCwzMDAwMCwyMzAwMCwyMDAwMCwyOTAwMCwxODAwMCwyMTAwMCwyMjAwMCwyNDAwMCwzMjAwMCwxNzAwMCwxMTAwMCwxMDAwMCwyODAwMCwyMTAwMCwyMDAwLDI5MDAwLDEyMDAwLDExMDAwLDMyMDAwLDE3MDAwLDE0MDAwLDIxMDAwLDE4MDAwLDI3MDAwLDEyMDAwLDEyMDAwLDEzMDAwLDMxMDAwLDE0MDAwLDMyMDAwLDIzMDAwLDI3MDAwLDIwMDAwLDI3MDAwLDIzMDAwLDE4MDAwLDIyMDAwLDI3MDAwLDIyMDAwLDExMDAwLDM0MDAwLDI1MDAwLDE5MDAwLDIzMDAwLDMzMDAwLDE1MDAwLDEzMDAwLDI3MDAwLDI1MDAwLDI5MDAwLDMyMDAwLDI5MDAwLDI4MDAwLDMyMDAwLDI5MDAwLDgwMDAsMzAwMDAsMzMwMDAsMTMwMDAsMTkwMDAsMzEwMDAsMjMwMDAsMjIwMDAsMzIwMDAsMjYwMDAsMzIwMDAsMTMwMDAsMjYwMDAsMzAwMDAsMzQwMDAsNzAwMCwyMjAwMCwzMjAwMCwyOTAwMCwyNjAwMCwyNDAwMCwyNTAwMCwxMTAwMCw4MDAwLDE4MDAwLDE2MDAwLDIxMDAwLDI4MDAwLDI4MDAwLDE1MDAwLDMyMDAwLDUwMDAsMjkwMDAsMzIwMDAsMzIwMDAsMTkwMDBdLCJvcHMiOjIxOTQwfSx7Im5hbWUiOiJGaW5kIGl0ZW0gMjAwIiwiY29kZSI6InZhciByZXN1bHQgPSAwO1xubWFwLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmVzdWx0ICs9IHZhbHVlO1xufSk7IiwicnVucyI6WzQwMDAsMTAwMCw5NTAwMCwyMDAwMCw0MDAwLDgwMDAsMjYwMDAsMTIwMDAwLDMwMDAsOTAwMDAsMjYwMDAsMzAwMDAsMjYwMDAsMjYwMDAsMzUwMDAsMjUwMDAsMTUwMDAsMTQ0MDAwLDIwMDAwLDI4MDAwLDEzMTAwMCw2MDAwMCw3OTAwMCwxNDcwMDAsNTEwMDAsOTAwMCw4MDAwLDY5MDAwLDI2MDAwLDExMDAwLDMyMDAwLDE5MDAwLDQxMDAwLDIyMDAwLDEwMDAwLDU0MDAwLDg3MDAwLDIxMDAwLDIxMDAwLDQwMDAsNjMwMDAsMjQwMDAsNDYwMDAsOTAwMCwxNzAwMCwzMzAwMCw2ODAwMCw1NTAwMCw3MDAwLDEwMTAwMCwzMzAwMCw1NjAwMCwzNzAwMCw3MjAwMCw1MjAwMCwxMDAwMCw4MDAwMCw1OTAwMCwxMDcwMDAsNzUwMDAsNDcwMDAsMzgwMDAsNTkwMDAsNDMwMDAsMTUwMDAsNjYwMDAsMTExMDAwLDE0MDAwLDIxMDAwLDEwMjAwMCw5NzAwMCwxNjAwMCwxMDUwMDAsMTExMDAwLDk5MDAwLDk4MDAwLDE4MDAwLDg3MDAwLDExMDAwMCw2MDAwLDI1MDAwLDkxMDAwLDk5MDAwLDYxMDAwLDczMDAwLDg3MDAwLDIxMDAwLDE2MDAwLDQ4MDAwLDMwMDAwLDMzMDAwLDEwMzAwMCwxMTIwMDAsMjkwMDAsODAwMDAsMTEyMDAwLDQ4MDAwLDgxMDAwLDEwMjAwMCwzMDAwMF0sIm9wcyI6NTE5NjB9XSwidXBkYXRlZCI6IjIwMjUtMDMtMDlUMDA6Mzk6MDkuODEyWiJ9)

8. 每个源文件编译后都要加入一份 helper 函数，造成体积浪费，对 JS 引擎优化也不友好。可以开启 tsconfig 的 importHelpers 选项，将 helper 函数从每个文件中移除，放到一个单独的文件中，而且可以减少代码体积。

- importHelpers 是 TypeScript 编译器的一个配置选项，用于优化生成的 JavaScript 代码。具体来说，当 TypeScript 进行某些向下兼容的操作（如类的扩展、数组或对象的展开、异步操作等）时，它会插入一些辅助函数。默认情况下，这些辅助函数会被插入到每个使用它们的文件中，这可能导致代码重复。通过启用 importHelpers 选项，这些辅助函数会被从 tslib 模块中导入，从而避免重复代码。